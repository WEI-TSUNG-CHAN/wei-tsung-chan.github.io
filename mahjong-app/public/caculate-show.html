<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>麻將計算資料</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: 'Orbitron', sans-serif;
            color: rgba(220, 230, 240, 0.85);
        }

        table {
            width: 600px;
            margin: 40px auto;
            border-collapse: collapse;
            background-color: rgba(20, 24, 30, 0.88);
            border: 1px solid rgba(100, 100, 100, 0.2);
            border-radius: 8px;
        }

        th,
        td {
            padding: 0.4rem 0.6rem;
            text-align: center;
            border: 1px solid rgba(80, 80, 80, 0.3);
            font-size: 2rem;
            color: rgba(240, 250, 255, 0.92);
        }

        th {
            background-color: rgba(35, 40, 50, 0.95);
            color: rgba(79, 195, 247, 0.95);
            font-weight: 700;
        }

        td:first-child {
            color: gold;
            font-weight: 700;
        }

        h1 {
            display: none;
        }

        tbody {
            display: table-row-group;
        }
    </style>

</head>

<body>
    <table>
        <thead>
            <tr>
                <th>類型</th>
                <th>台數</th>
                <th>時間</th>
            </tr>
        </thead>
        <tbody id="data-body">
            <!-- 資料將由 JS 動態插入 -->
        </tbody>
    </table>

    <script>
        function formatDateTime(datetimeString) {
            const date = new Date(datetimeString);
            const pad = (n) => n.toString().padStart(2, '0');
            const yyyy = date.getFullYear();
            const mm = pad(date.getMonth() + 1);
            const dd = pad(date.getDate());
            const hh = pad(date.getHours());
            const mi = pad(date.getMinutes());
            const ss = pad(date.getSeconds());
            return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss}`;
        }

        // 用於載入計算資料
        function loadCalculateData() {
            fetch('/calculate/active', { method: 'POST' }) // 你需要設計這個 API：回傳符合 flag = 1 的資料
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('data-body');
                    tbody.innerHTML = '';

                    data.sort((a, b) => a.tie - b.tie); // 確保 tie 由小到大

                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.type}</td>
                            <td>${item.tie}</td>
                            <td>${formatDateTime(item.now)}</td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(err => {
                    console.error('資料載入錯誤:', err);
                });
        }

        document.addEventListener('DOMContentLoaded', loadCalculateData);
    </script>
</body>

</html>