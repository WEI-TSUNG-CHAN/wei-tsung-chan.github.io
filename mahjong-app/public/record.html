<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æˆ°ç¸¾æŸ¥è©¢ - èƒ¡ç‰Œäººç”Ÿ</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
    }

    input,
    select,
    button {
      font-size: 1rem;
      margin: 4px 2px;
      padding: 6px 10px;
    }

    #queryResult {
      margin-top: 20px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      white-space: pre-line;
    }
  </style>
</head>

<body>
  <h2>æˆ°ç¸¾æŸ¥è©¢ç³»çµ±</h2>

  <p>
    æ—¥æœŸï¼š<input type="date" id="datePicker">
    å°‡æ•¸ï¼š
    <select id="dealerCount">
      <option value="1">ç¬¬ä¸€å°‡</option>
      <option value="2">ç¬¬äºŒå°‡</option>
      <option value="3">ç¬¬ä¸‰å°‡</option>
      <option value="4">ç¬¬å››å°‡</option>
      <option value="5">ç¬¬äº”å°‡</option>
      <option value="6">ç¬¬å…­å°‡</option>
      <option value="7">ç¬¬ä¸ƒå°‡</option>
      <option value="8">ç¬¬å…«å°‡</option>
    </select>
    <button id="queryBtn">æŸ¥è©¢</button>
  </p>

  <div id="queryResult">å°šæœªæŸ¥è©¢</div>

  <script>
    document.getElementById('queryBtn').addEventListener('click', () => {
      const selectedDate = document.getElementById('datePicker').value;
      const dealerCount = document.getElementById('dealerCount').value;

      if (!selectedDate) {
        alert("è«‹å…ˆé¸æ“‡æ—¥æœŸ");
        return;
      }

      fetch(`/stats?date=${selectedDate}&round_number=${dealerCount}`)
        .then(res => res.json())
        .then(data => {
          const playerNames = data.slice(0, 4).map(record => record.player_name).join(",");
          let resultText = `${playerNames}\n\n`;

          resultText += "æ­¡è¿ä¾†åˆ°ã€Šèƒ¡ç‰Œäººç”Ÿã€‹ï¼ ğŸ‘‰æœ¬ç‰‡ç´”å±¬å¨›æ¨‚èˆ‡åˆ†äº«ï¼Œç„¡ç¾é‡‘è³­åšè¡Œç‚º\néº»å°‡æ„›å¥½è€…çš„å¤©å ‚ï¼Œé«”é©—è‡ªæ‘¸èˆ‡çˆ†èƒ¡å¿«æ„Ÿï¼Œæ¯å±€éƒ½æ˜¯ç²¾å½©å°æ±ºï¼\n\n" +
            "äº«å—æ›´é«˜ç•«è³ªï¼š\nè¨­å®š âš™ï¸ ã€‹ç•«è³ª ã€‹é€²éšï¼Œé¸æ“‡è§£æåº¦\n\n" +
            "æœ¬å±€æˆ°ç¸¾ï¼š\n";

          if (Array.isArray(data) && data.length > 0) {
            data.slice(0, 4).forEach(record => {
              resultText += `ğŸ”¹ ${record.player_name}ï¼š${record.total_score}\n`;
            });
          } else {
            resultText += "æš«ç„¡è³‡æ–™\n";
          }

          resultText += "\nğŸ“Œ è¨˜å¾—è¨‚é–±ã€æŒ‰è®šï¼Œé–‹å•Ÿå°éˆ´éºï¼Œä¸éŒ¯éæ¯å ´åˆºæ¿€å°æˆ°ï¼\n#èƒ¡ç‰Œäººç”Ÿ #éº»å°‡ #éº»å°‡å°æˆ°";

          document.getElementById('queryResult').textContent = resultText;
        })
        .catch(err => {
          console.error("æŸ¥è©¢éŒ¯èª¤", err);
          alert("æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
        });
    });
  </script>
</body>

</html>